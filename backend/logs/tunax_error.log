2025-12-15 14:46:30,649 CRITICAL: Unexpected Error: name 'Property' is not defined [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 72, in list_municipalities
    'municipalities': [{
                      ^^
  File "/app/resources/ministry.py", line 78, in <listcomp>
    'properties': Property.query.filter_by(commune_id=c.id).count(),
                  ^^^^^^^^
NameError: name 'Property' is not defined
2025-12-15 14:46:37,508 CRITICAL: Unexpected Error: name 'Property' is not defined [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 72, in list_municipalities
    'municipalities': [{
                      ^^
  File "/app/resources/ministry.py", line 78, in <listcomp>
    'properties': Property.query.filter_by(commune_id=c.id).count(),
                  ^^^^^^^^
NameError: name 'Property' is not defined
2025-12-15 14:46:49,430 CRITICAL: Unexpected Error: name 'Property' is not defined [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 72, in list_municipalities
    'municipalities': [{
                      ^^
  File "/app/resources/ministry.py", line 78, in <listcomp>
    'properties': Property.query.filter_by(commune_id=c.id).count(),
                  ^^^^^^^^
NameError: name 'Property' is not defined
2025-12-15 14:47:03,346 CRITICAL: Unexpected Error: name 'Property' is not defined [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 72, in list_municipalities
    'municipalities': [{
                      ^^
  File "/app/resources/ministry.py", line 78, in <listcomp>
    'properties': Property.query.filter_by(commune_id=c.id).count(),
                  ^^^^^^^^
NameError: name 'Property' is not defined
2025-12-15 14:50:00,554 CRITICAL: Unexpected Error: 'Commune' object has no attribute 'nom_wilaya_fr' [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 84, in list_municipalities
    'nom_wilaya_fr': commune.nom_wilaya_fr,
                     ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Commune' object has no attribute 'nom_wilaya_fr'
2025-12-15 14:50:02,361 CRITICAL: Unexpected Error: 'Commune' object has no attribute 'nom_wilaya_fr' [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 84, in list_municipalities
    'nom_wilaya_fr': commune.nom_wilaya_fr,
                     ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Commune' object has no attribute 'nom_wilaya_fr'
2025-12-15 14:50:56,022 CRITICAL: Unexpected Error: 'Commune' object has no attribute 'nom_wilaya_fr' [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 84, in list_municipalities
    'nom_wilaya_fr': commune.nom_wilaya_fr,
                     ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Commune' object has no attribute 'nom_wilaya_fr'
2025-12-15 14:50:58,890 CRITICAL: Unexpected Error: 'Commune' object has no attribute 'nom_wilaya_fr' [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 84, in list_municipalities
    'nom_wilaya_fr': commune.nom_wilaya_fr,
                     ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Commune' object has no attribute 'nom_wilaya_fr'
2025-12-15 14:51:07,743 CRITICAL: Unexpected Error: 'Commune' object has no attribute 'nom_wilaya_fr' [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 84, in list_municipalities
    'nom_wilaya_fr': commune.nom_wilaya_fr,
                     ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Commune' object has no attribute 'nom_wilaya_fr'
2025-12-15 14:51:53,893 CRITICAL: Unexpected Error: 'Commune' object has no attribute 'nom_wilaya_fr' [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 84, in list_municipalities
    'nom_wilaya_fr': commune.nom_wilaya_fr,
                     ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Commune' object has no attribute 'nom_wilaya_fr'
2025-12-15 14:53:37,445 CRITICAL: Unexpected Error: 'Commune' object has no attribute 'nom_wilaya_fr' [in /app/app.py:214]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 83, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 83, in list_municipalities
    'nom_wilaya_fr': commune.nom_wilaya_fr,
                     ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Commune' object has no attribute 'nom_wilaya_fr'
2025-12-15 17:14:18,558 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:14:19,572 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:14:21,614 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:14:22,538 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:14:46,198 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:14:47,302 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:14:49,293 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:15:00,488 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:15:28,604 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:16:49,461 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ttnb.py", line 197, in get_lands
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:16:49,472 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ttnb.py", line 197, in get_lands
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:16:49,483 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 306, in get_properties
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:16:49,489 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:16:50,937 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ttnb.py", line 197, in get_lands
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:16:52,298 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 306, in get_properties
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:17:07,883 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ttnb.py", line 197, in get_lands
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:17:22,981 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ttnb.py", line 197, in get_lands
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:17:22,982 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ttnb.py", line 197, in get_lands
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:17:22,989 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 306, in get_properties
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:17:23,000 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:17:25,052 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 142, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ttnb.py", line 197, in get_lands
    if user.role in [UserRole.CITIZEN, UserRole.BUSINESS]:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:36:25,035 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 17:36:26,195 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'role' [in /app/app.py:216]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/dispute.py", line 58, in get_disputes
    if user.role == UserRole.CITIZEN or user.role == UserRole.BUSINESS:
       ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'role'
2025-12-15 19:48:47,788 ERROR: Database Error: Mapper 'Mapper[Commune(commune)]' has no property 'document_requirements'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called. [in /app/app.py:199]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 2505, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'document_requirements'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/public.py", line 239, in get_document_requirements
    commune = Commune.query.get(commune_id)
              ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/model.py", line 22, in __get__
    return cls.query_class(
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 276, in __init__
    self._set_entities(entities)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 288, in _set_entities
    self._raw_columns = [
                        ^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 289, in <listcomp>
    coercions.expect(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/coercions.py", line 406, in expect
    insp._post_inspect
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 1260, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 2707, in _post_inspect
    self._check_configure()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 2386, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 4199, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 4240, in _do_configure_registries
    mapper._post_configure_properties()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 2403, in _post_configure_properties
    prop.init()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/interfaces.py", line 579, in init
    self.do_init()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/relationships.py", line 1640, in do_init
    self._generate_backref()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/relationships.py", line 2129, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/relationships.py", line 1571, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/mapper.py", line 2507, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[Commune(commune)]' has no property 'document_requirements'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-17 14:51:02,655 CRITICAL: Unexpected Error: Object of type PropertyAffectation is not JSON serializable [in /app/app.py:237]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 140, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 344, in get_properties
    return jsonify({'properties': result}), 200
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type PropertyAffectation is not JSON serializable
2025-12-17 14:51:12,389 CRITICAL: Unexpected Error: Object of type PropertyAffectation is not JSON serializable [in /app/app.py:237]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 140, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 344, in get_properties
    return jsonify({'properties': result}), 200
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type PropertyAffectation is not JSON serializable
2025-12-17 14:51:15,709 CRITICAL: Unexpected Error: Object of type PropertyAffectation is not JSON serializable [in /app/app.py:237]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 140, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 344, in get_properties
    return jsonify({'properties': result}), 200
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type PropertyAffectation is not JSON serializable
2025-12-17 14:52:25,342 CRITICAL: Unexpected Error: Object of type LandType is not JSON serializable [in /app/app.py:237]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 140, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ttnb.py", line 230, in get_lands
    return jsonify({'lands': result}), 200
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type LandType is not JSON serializable
2025-12-18 19:37:27,602 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^

[SQL: UPDATE properties SET surface_couverte=%(surface_couverte)s, affectation=%(affectation)s, updated_at=%(updated_at)s WHERE properties.id = %(properties_id)s]
[parameters: {'surface_couverte': 160, 'affectation': 'commercial', 'updated_at': datetime.datetime(2025, 12, 18, 19, 37, 27, 599815), 'properties_id': 1}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:221]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 500, in update_property
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 909, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^

[SQL: UPDATE properties SET surface_couverte=%(surface_couverte)s, affectation=%(affectation)s, updated_at=%(updated_at)s WHERE properties.id = %(properties_id)s]
[parameters: {'surface_couverte': 160, 'affectation': 'commercial', 'updated_at': datetime.datetime(2025, 12, 18, 19, 37, 27, 599815), 'properties_id': 1}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 19:37:27,982 CRITICAL: Unexpected Error: cannot import name 'generate_payment_receipt' from 'utils.pdf_generator' (/app/utils/pdf_generator.py) [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/payment.py", line 310, in get_payment_receipt
    from utils.pdf_generator import generate_payment_receipt
ImportError: cannot import name 'generate_payment_receipt' from 'utils.pdf_generator' (/app/utils/pdf_generator.py)
2025-12-18 19:37:28,447 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 3: ...city ILIKE '%tunis%' AND properties.affectation = 'residenti...
                                                             ^

[SQL: SELECT properties.id AS properties_id, properties.owner_id AS properties_owner_id, properties.commune_id AS properties_commune_id, properties.street_address AS properties_street_address, properties.city AS properties_city, properties.delegation AS properties_delegation, properties.post_code AS properties_post_code, properties.latitude AS properties_latitude, properties.longitude AS properties_longitude, properties.surface_couverte AS properties_surface_couverte, properties.surface_totale AS properties_surface_totale, properties.affectation AS properties_affectation, properties.nb_floors AS properties_nb_floors, properties.nb_rooms AS properties_nb_rooms, properties.construction_year AS properties_construction_year, properties.reference_price_per_m2 AS properties_reference_price_per_m2, properties.tax_rate_category AS properties_tax_rate_category, properties.service_rate AS properties_service_rate, properties.status AS properties_status, properties.is_exempt AS properties_is_exempt, properties.exemption_reason AS properties_exemption_reason, properties.satellite_verified AS properties_satellite_verified, properties.satellite_verification_date AS properties_satellite_verification_date, properties.satellite_notes AS properties_satellite_notes, properties.created_at AS properties_created_at, properties.updated_at AS properties_updated_at 
FROM properties 
WHERE properties.city ILIKE %(city_1)s AND properties.affectation = %(affectation_1)s AND properties.surface_couverte >= %(surface_couverte_1)s AND properties.surface_couverte <= %(surface_couverte_2)s 
 LIMIT %(param_1)s OFFSET %(param_2)s]
[parameters: {'city_1': '%tunis%', 'affectation_1': 'residential', 'surface_couverte_1': 100.0, 'surface_couverte_2': 200.0, 'param_1': 20, 'param_2': 0}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:221]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 3: ...city ILIKE '%tunis%' AND properties.affectation = 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/search.py", line 129, in search_properties
    results = query.paginate(page=page, per_page=per_page)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/query.py", line 98, in paginate
    return QueryPagination(
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/pagination.py", line 72, in __init__
    items = self._query_items()
            ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/pagination.py", line 358, in _query_items
    out = query.limit(self.per_page).offset(self._query_offset).all()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2693, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2847, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 3: ...city ILIKE '%tunis%' AND properties.affectation = 'residenti...
                                                             ^

[SQL: SELECT properties.id AS properties_id, properties.owner_id AS properties_owner_id, properties.commune_id AS properties_commune_id, properties.street_address AS properties_street_address, properties.city AS properties_city, properties.delegation AS properties_delegation, properties.post_code AS properties_post_code, properties.latitude AS properties_latitude, properties.longitude AS properties_longitude, properties.surface_couverte AS properties_surface_couverte, properties.surface_totale AS properties_surface_totale, properties.affectation AS properties_affectation, properties.nb_floors AS properties_nb_floors, properties.nb_rooms AS properties_nb_rooms, properties.construction_year AS properties_construction_year, properties.reference_price_per_m2 AS properties_reference_price_per_m2, properties.tax_rate_category AS properties_tax_rate_category, properties.service_rate AS properties_service_rate, properties.status AS properties_status, properties.is_exempt AS properties_is_exempt, properties.exemption_reason AS properties_exemption_reason, properties.satellite_verified AS properties_satellite_verified, properties.satellite_verification_date AS properties_satellite_verification_date, properties.satellite_notes AS properties_satellite_notes, properties.created_at AS properties_created_at, properties.updated_at AS properties_updated_at 
FROM properties 
WHERE properties.city ILIKE %(city_1)s AND properties.affectation = %(affectation_1)s AND properties.surface_couverte >= %(surface_couverte_1)s AND properties.surface_couverte <= %(surface_couverte_2)s 
 LIMIT %(param_1)s OFFSET %(param_2)s]
[parameters: {'city_1': '%tunis%', 'affectation_1': 'residential', 'surface_couverte_1': 100.0, 'surface_couverte_2': 200.0, 'param_1': 20, 'param_2': 0}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 19:37:28,466 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum landtype: "agricultural"
LINE 3: ...E lands.city ILIKE '%sfax%' AND lands.land_type = 'agricultu...
                                                             ^

[SQL: SELECT lands.id AS lands_id, lands.owner_id AS lands_owner_id, lands.commune_id AS lands_commune_id, lands.street_address AS lands_street_address, lands.city AS lands_city, lands.delegation AS lands_delegation, lands.post_code AS lands_post_code, lands.latitude AS lands_latitude, lands.longitude AS lands_longitude, lands.surface AS lands_surface, lands.land_type AS lands_land_type, lands.urban_zone AS lands_urban_zone, lands."vnale_value" AS "lands_vnale_value", lands.tariff_value AS lands_tariff_value, lands.is_exempt AS lands_is_exempt, lands.exemption_reason AS lands_exemption_reason, lands.status AS lands_status, lands.satellite_verified AS lands_satellite_verified, lands.satellite_verification_date AS lands_satellite_verification_date, lands.satellite_notes AS lands_satellite_notes, lands.created_at AS lands_created_at, lands.updated_at AS lands_updated_at 
FROM lands 
WHERE lands.city ILIKE %(city_1)s AND lands.land_type = %(land_type_1)s AND lands.surface >= %(surface_1)s AND lands.is_exempt = true 
 LIMIT %(param_1)s OFFSET %(param_2)s]
[parameters: {'city_1': '%sfax%', 'land_type_1': 'agricultural', 'surface_1': 500.0, 'param_1': 20, 'param_2': 0}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:221]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum landtype: "agricultural"
LINE 3: ...E lands.city ILIKE '%sfax%' AND lands.land_type = 'agricultu...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/search.py", line 252, in search_lands
    results = query.paginate(page=page, per_page=per_page)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/query.py", line 98, in paginate
    return QueryPagination(
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/pagination.py", line 72, in __init__
    items = self._query_items()
            ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/pagination.py", line 358, in _query_items
    out = query.limit(self.per_page).offset(self._query_offset).all()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2693, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2847, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum landtype: "agricultural"
LINE 3: ...E lands.city ILIKE '%sfax%' AND lands.land_type = 'agricultu...
                                                             ^

[SQL: SELECT lands.id AS lands_id, lands.owner_id AS lands_owner_id, lands.commune_id AS lands_commune_id, lands.street_address AS lands_street_address, lands.city AS lands_city, lands.delegation AS lands_delegation, lands.post_code AS lands_post_code, lands.latitude AS lands_latitude, lands.longitude AS lands_longitude, lands.surface AS lands_surface, lands.land_type AS lands_land_type, lands.urban_zone AS lands_urban_zone, lands."vnale_value" AS "lands_vnale_value", lands.tariff_value AS lands_tariff_value, lands.is_exempt AS lands_is_exempt, lands.exemption_reason AS lands_exemption_reason, lands.status AS lands_status, lands.satellite_verified AS lands_satellite_verified, lands.satellite_verification_date AS lands_satellite_verification_date, lands.satellite_notes AS lands_satellite_notes, lands.created_at AS lands_created_at, lands.updated_at AS lands_updated_at 
FROM lands 
WHERE lands.city ILIKE %(city_1)s AND lands.land_type = %(land_type_1)s AND lands.surface >= %(surface_1)s AND lands.is_exempt = true 
 LIMIT %(param_1)s OFFSET %(param_2)s]
[parameters: {'city_1': '%sfax%', 'land_type_1': 'agricultural', 'surface_1': 500.0, 'param_1': 20, 'param_2': 0}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 19:37:28,613 CRITICAL: Unexpected Error: name 'User' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/notifications.py", line 196, in update_notification_settings
    user = User.query.get(user_id)
           ^^^^
NameError: name 'User' is not defined
2025-12-18 19:37:28,807 CRITICAL: Unexpected Error: 'NoneType' object has no attribute 'nom_municipalite_fr' [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 140, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/municipal.py", line 58, in get_dashboard
    'name': Commune.query.get(user.commune_id).nom_municipalite_fr
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'nom_municipalite_fr'
2025-12-18 19:39:38,310 CRITICAL: Unexpected Error: Object of type PropertyAffectation is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 75, in get_properties_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type PropertyAffectation is not JSON serializable
2025-12-18 19:39:38,344 CRITICAL: Unexpected Error: Object of type LandType is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 146, in get_lands_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type LandType is not JSON serializable
2025-12-18 19:39:39,136 CRITICAL: Unexpected Error: OVERDUE [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 150, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/municipal.py", line 787, in get_taxes_summary
    'overdue': len([t for t in taxes if t.status == TaxStatus.OVERDUE])
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/municipal.py", line 787, in <listcomp>
    'overdue': len([t for t in taxes if t.status == TaxStatus.OVERDUE])
                                                    ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/enum.py", line 786, in __getattr__
    raise AttributeError(name) from None
AttributeError: OVERDUE
2025-12-18 19:39:39,803 CRITICAL: Unexpected Error: name 'Property' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 87, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 422, in get_revenue_report
    Property, Tax.property_id == Property.id
    ^^^^^^^^
NameError: name 'Property' is not defined
2025-12-18 19:40:39,880 CRITICAL: Unexpected Error: Object of type PropertyAffectation is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 75, in get_properties_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type PropertyAffectation is not JSON serializable
2025-12-18 19:40:39,897 CRITICAL: Unexpected Error: Object of type LandType is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 146, in get_lands_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type LandType is not JSON serializable
2025-12-18 19:40:40,515 CRITICAL: Unexpected Error: OVERDUE [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 150, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/municipal.py", line 787, in get_taxes_summary
    'overdue': len([t for t in taxes if t.status == TaxStatus.OVERDUE])
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/municipal.py", line 787, in <listcomp>
    'overdue': len([t for t in taxes if t.status == TaxStatus.OVERDUE])
                                                    ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/enum.py", line 786, in __getattr__
    raise AttributeError(name) from None
AttributeError: OVERDUE
2025-12-18 19:40:41,239 CRITICAL: Unexpected Error: name 'Property' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 87, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 422, in get_revenue_report
    Property, Tax.property_id == Property.id
    ^^^^^^^^
NameError: name 'Property' is not defined
2025-12-18 19:50:52,314 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^

[SQL: UPDATE properties SET surface_couverte=%(surface_couverte)s, affectation=%(affectation)s, updated_at=%(updated_at)s WHERE properties.id = %(properties_id)s]
[parameters: {'surface_couverte': 160, 'affectation': 'commercial', 'updated_at': datetime.datetime(2025, 12, 18, 19, 50, 52, 311570), 'properties_id': 1}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:221]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 500, in update_property
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 909, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^

[SQL: UPDATE properties SET surface_couverte=%(surface_couverte)s, affectation=%(affectation)s, updated_at=%(updated_at)s WHERE properties.id = %(properties_id)s]
[parameters: {'surface_couverte': 160, 'affectation': 'commercial', 'updated_at': datetime.datetime(2025, 12, 18, 19, 50, 52, 311570), 'properties_id': 1}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 19:50:52,637 CRITICAL: Unexpected Error: cannot import name 'generate_payment_receipt' from 'utils.pdf_generator' (/app/utils/pdf_generator.py) [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/payment.py", line 310, in get_payment_receipt
    from utils.pdf_generator import generate_payment_receipt
ImportError: cannot import name 'generate_payment_receipt' from 'utils.pdf_generator' (/app/utils/pdf_generator.py)
2025-12-18 19:50:53,047 CRITICAL: Unexpected Error: Object of type PropertyAffectation is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 75, in get_properties_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type PropertyAffectation is not JSON serializable
2025-12-18 19:50:53,068 CRITICAL: Unexpected Error: Object of type LandType is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 146, in get_lands_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type LandType is not JSON serializable
2025-12-18 19:50:53,158 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 3: ...city ILIKE '%tunis%' AND properties.affectation = 'residenti...
                                                             ^

[SQL: SELECT properties.id AS properties_id, properties.owner_id AS properties_owner_id, properties.commune_id AS properties_commune_id, properties.street_address AS properties_street_address, properties.city AS properties_city, properties.delegation AS properties_delegation, properties.post_code AS properties_post_code, properties.latitude AS properties_latitude, properties.longitude AS properties_longitude, properties.surface_couverte AS properties_surface_couverte, properties.surface_totale AS properties_surface_totale, properties.affectation AS properties_affectation, properties.nb_floors AS properties_nb_floors, properties.nb_rooms AS properties_nb_rooms, properties.construction_year AS properties_construction_year, properties.reference_price_per_m2 AS properties_reference_price_per_m2, properties.tax_rate_category AS properties_tax_rate_category, properties.service_rate AS properties_service_rate, properties.status AS properties_status, properties.is_exempt AS properties_is_exempt, properties.exemption_reason AS properties_exemption_reason, properties.satellite_verified AS properties_satellite_verified, properties.satellite_verification_date AS properties_satellite_verification_date, properties.satellite_notes AS properties_satellite_notes, properties.created_at AS properties_created_at, properties.updated_at AS properties_updated_at 
FROM properties 
WHERE properties.city ILIKE %(city_1)s AND properties.affectation = %(affectation_1)s AND properties.surface_couverte >= %(surface_couverte_1)s AND properties.surface_couverte <= %(surface_couverte_2)s 
 LIMIT %(param_1)s OFFSET %(param_2)s]
[parameters: {'city_1': '%tunis%', 'affectation_1': 'residential', 'surface_couverte_1': 100.0, 'surface_couverte_2': 200.0, 'param_1': 20, 'param_2': 0}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:221]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 3: ...city ILIKE '%tunis%' AND properties.affectation = 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/search.py", line 129, in search_properties
    results = query.paginate(page=page, per_page=per_page)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/query.py", line 98, in paginate
    return QueryPagination(
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/pagination.py", line 72, in __init__
    items = self._query_items()
            ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/pagination.py", line 358, in _query_items
    out = query.limit(self.per_page).offset(self._query_offset).all()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2693, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2847, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 3: ...city ILIKE '%tunis%' AND properties.affectation = 'residenti...
                                                             ^

[SQL: SELECT properties.id AS properties_id, properties.owner_id AS properties_owner_id, properties.commune_id AS properties_commune_id, properties.street_address AS properties_street_address, properties.city AS properties_city, properties.delegation AS properties_delegation, properties.post_code AS properties_post_code, properties.latitude AS properties_latitude, properties.longitude AS properties_longitude, properties.surface_couverte AS properties_surface_couverte, properties.surface_totale AS properties_surface_totale, properties.affectation AS properties_affectation, properties.nb_floors AS properties_nb_floors, properties.nb_rooms AS properties_nb_rooms, properties.construction_year AS properties_construction_year, properties.reference_price_per_m2 AS properties_reference_price_per_m2, properties.tax_rate_category AS properties_tax_rate_category, properties.service_rate AS properties_service_rate, properties.status AS properties_status, properties.is_exempt AS properties_is_exempt, properties.exemption_reason AS properties_exemption_reason, properties.satellite_verified AS properties_satellite_verified, properties.satellite_verification_date AS properties_satellite_verification_date, properties.satellite_notes AS properties_satellite_notes, properties.created_at AS properties_created_at, properties.updated_at AS properties_updated_at 
FROM properties 
WHERE properties.city ILIKE %(city_1)s AND properties.affectation = %(affectation_1)s AND properties.surface_couverte >= %(surface_couverte_1)s AND properties.surface_couverte <= %(surface_couverte_2)s 
 LIMIT %(param_1)s OFFSET %(param_2)s]
[parameters: {'city_1': '%tunis%', 'affectation_1': 'residential', 'surface_couverte_1': 100.0, 'surface_couverte_2': 200.0, 'param_1': 20, 'param_2': 0}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 19:50:53,171 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum landtype: "agricultural"
LINE 3: ...E lands.city ILIKE '%sfax%' AND lands.land_type = 'agricultu...
                                                             ^

[SQL: SELECT lands.id AS lands_id, lands.owner_id AS lands_owner_id, lands.commune_id AS lands_commune_id, lands.street_address AS lands_street_address, lands.city AS lands_city, lands.delegation AS lands_delegation, lands.post_code AS lands_post_code, lands.latitude AS lands_latitude, lands.longitude AS lands_longitude, lands.surface AS lands_surface, lands.land_type AS lands_land_type, lands.urban_zone AS lands_urban_zone, lands."vnale_value" AS "lands_vnale_value", lands.tariff_value AS lands_tariff_value, lands.is_exempt AS lands_is_exempt, lands.exemption_reason AS lands_exemption_reason, lands.status AS lands_status, lands.satellite_verified AS lands_satellite_verified, lands.satellite_verification_date AS lands_satellite_verification_date, lands.satellite_notes AS lands_satellite_notes, lands.created_at AS lands_created_at, lands.updated_at AS lands_updated_at 
FROM lands 
WHERE lands.city ILIKE %(city_1)s AND lands.land_type = %(land_type_1)s AND lands.surface >= %(surface_1)s AND lands.is_exempt = true 
 LIMIT %(param_1)s OFFSET %(param_2)s]
[parameters: {'city_1': '%sfax%', 'land_type_1': 'agricultural', 'surface_1': 500.0, 'param_1': 20, 'param_2': 0}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:221]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum landtype: "agricultural"
LINE 3: ...E lands.city ILIKE '%sfax%' AND lands.land_type = 'agricultu...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/search.py", line 252, in search_lands
    results = query.paginate(page=page, per_page=per_page)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/query.py", line 98, in paginate
    return QueryPagination(
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/pagination.py", line 72, in __init__
    items = self._query_items()
            ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_sqlalchemy/pagination.py", line 358, in _query_items
    out = query.limit(self.per_page).offset(self._query_offset).all()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2693, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2847, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum landtype: "agricultural"
LINE 3: ...E lands.city ILIKE '%sfax%' AND lands.land_type = 'agricultu...
                                                             ^

[SQL: SELECT lands.id AS lands_id, lands.owner_id AS lands_owner_id, lands.commune_id AS lands_commune_id, lands.street_address AS lands_street_address, lands.city AS lands_city, lands.delegation AS lands_delegation, lands.post_code AS lands_post_code, lands.latitude AS lands_latitude, lands.longitude AS lands_longitude, lands.surface AS lands_surface, lands.land_type AS lands_land_type, lands.urban_zone AS lands_urban_zone, lands."vnale_value" AS "lands_vnale_value", lands.tariff_value AS lands_tariff_value, lands.is_exempt AS lands_is_exempt, lands.exemption_reason AS lands_exemption_reason, lands.status AS lands_status, lands.satellite_verified AS lands_satellite_verified, lands.satellite_verification_date AS lands_satellite_verification_date, lands.satellite_notes AS lands_satellite_notes, lands.created_at AS lands_created_at, lands.updated_at AS lands_updated_at 
FROM lands 
WHERE lands.city ILIKE %(city_1)s AND lands.land_type = %(land_type_1)s AND lands.surface >= %(surface_1)s AND lands.is_exempt = true 
 LIMIT %(param_1)s OFFSET %(param_2)s]
[parameters: {'city_1': '%sfax%', 'land_type_1': 'agricultural', 'surface_1': 500.0, 'param_1': 20, 'param_2': 0}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 19:50:53,254 CRITICAL: Unexpected Error: name 'User' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/notifications.py", line 196, in update_notification_settings
    user = User.query.get(user_id)
           ^^^^
NameError: name 'User' is not defined
2025-12-18 19:50:53,707 CRITICAL: Unexpected Error: OVERDUE [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 150, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/municipal.py", line 787, in get_taxes_summary
    'overdue': len([t for t in taxes if t.status == TaxStatus.OVERDUE])
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/municipal.py", line 787, in <listcomp>
    'overdue': len([t for t in taxes if t.status == TaxStatus.OVERDUE])
                                                    ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/enum.py", line 786, in __getattr__
    raise AttributeError(name) from None
AttributeError: OVERDUE
2025-12-18 19:50:54,431 CRITICAL: Unexpected Error: name 'Property' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 87, in decorator
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/ministry.py", line 422, in get_revenue_report
    Property, Tax.property_id == Property.id
    ^^^^^^^^
NameError: name 'Property' is not defined
2025-12-18 19:54:06,003 CRITICAL: Unexpected Error: Object of type PropertyAffectation is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 75, in get_properties_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type PropertyAffectation is not JSON serializable
2025-12-18 19:54:06,043 CRITICAL: Unexpected Error: Object of type LandType is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 146, in get_lands_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type LandType is not JSON serializable
2025-12-18 19:54:43,258 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^

[SQL: UPDATE properties SET surface_couverte=%(surface_couverte)s, affectation=%(affectation)s, updated_at=%(updated_at)s WHERE properties.id = %(properties_id)s]
[parameters: {'surface_couverte': 160, 'affectation': 'commercial', 'updated_at': datetime.datetime(2025, 12, 18, 19, 54, 43, 256142), 'properties_id': 1}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:221]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/tib.py", line 499, in update_property
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 909, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "commercial"
LINE 1: ... properties SET surface_couverte=160, affectation='commercia...
                                                             ^

[SQL: UPDATE properties SET surface_couverte=%(surface_couverte)s, affectation=%(affectation)s, updated_at=%(updated_at)s WHERE properties.id = %(properties_id)s]
[parameters: {'surface_couverte': 160, 'affectation': 'commercial', 'updated_at': datetime.datetime(2025, 12, 18, 19, 54, 43, 256142), 'properties_id': 1}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 19:54:43,476 CRITICAL: Unexpected Error: cannot import name 'generate_payment_receipt' from 'utils.pdf_generator' (/app/utils/pdf_generator.py) [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/payment.py", line 310, in get_payment_receipt
    from utils.pdf_generator import generate_payment_receipt
ImportError: cannot import name 'generate_payment_receipt' from 'utils.pdf_generator' (/app/utils/pdf_generator.py)
2025-12-18 19:54:43,840 CRITICAL: Unexpected Error: Object of type PropertyAffectation is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 75, in get_properties_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type PropertyAffectation is not JSON serializable
2025-12-18 19:54:43,869 CRITICAL: Unexpected Error: Object of type LandType is not JSON serializable [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/inspector.py", line 146, in get_lands_to_inspect
    return jsonify({
           ^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 202, in encode
    chunks = list(chunks)
             ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 326, in _iterencode_list
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/local/lib/python3.11/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type LandType is not JSON serializable
2025-12-18 19:54:44,094 CRITICAL: Unexpected Error: name 'User' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/notifications.py", line 196, in update_notification_settings
    user = User.query.get(user_id)
           ^^^^
NameError: name 'User' is not defined
2025-12-18 19:58:08,790 CRITICAL: Unexpected Error: name 'get_jwt' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/payment.py", line 316, in get_payment_receipt
    role = get_jwt()['role']
           ^^^^^^^
NameError: name 'get_jwt' is not defined
2025-12-18 19:58:52,280 CRITICAL: Unexpected Error: name 'get_jwt' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/payment.py", line 316, in get_payment_receipt
    role = get_jwt()['role']
           ^^^^^^^
NameError: name 'get_jwt' is not defined
2025-12-18 20:01:13,857 CRITICAL: Unexpected Error: name 'get_jwt' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/payment.py", line 316, in get_payment_receipt
    role = get_jwt()['role']
           ^^^^^^^
NameError: name 'get_jwt' is not defined
2025-12-18 20:24:24,413 CRITICAL: Unexpected Error: name 'verify_property_ownership' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/agent.py", line 363, in verify_property_alias
    return verify_property_ownership(property_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'verify_property_ownership' is not defined
2025-12-18 20:24:24,433 CRITICAL: Unexpected Error: name 'verify_land_ownership' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/agent.py", line 370, in verify_land_alias
    return verify_land_ownership(land_id)
           ^^^^^^^^^^^^^^^^^^^^^
NameError: name 'verify_land_ownership' is not defined
2025-12-18 20:24:24,460 CRITICAL: Unexpected Error: name 'update_reclamation_status' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/agent.py", line 384, in update_reclamation_alias
    return update_reclamation_status(reclamation_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'update_reclamation_status' is not defined
2025-12-18 20:27:11,536 CRITICAL: Unexpected Error: name 'verify_property_ownership' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/agent.py", line 363, in verify_property_alias
    return verify_property_ownership(property_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'verify_property_ownership' is not defined
2025-12-18 20:27:11,564 CRITICAL: Unexpected Error: name 'verify_land_ownership' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/agent.py", line 370, in verify_land_alias
    return verify_land_ownership(land_id)
           ^^^^^^^^^^^^^^^^^^^^^
NameError: name 'verify_land_ownership' is not defined
2025-12-18 20:27:11,593 CRITICAL: Unexpected Error: name 'update_reclamation_status' is not defined [in /app/app.py:238]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/agent.py", line 384, in update_reclamation_alias
    return update_reclamation_status(reclamation_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'update_reclamation_status' is not defined
2025-12-18 22:11:48,005 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 11, 48, 2749), 'updated_at': datetime.datetime(2025, 12, 18, 22, 11, 48, 2751)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 247, in declare_property
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 11, 48, 2749), 'updated_at': datetime.datetime(2025, 12, 18, 22, 11, 48, 2751)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:11:48,131 CRITICAL: Unexpected Error: 'ttnb' [in /app/app.py:263]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 166, in declare_land
    tax_amount=calc_result['ttnb'],
               ~~~~~~~~~~~^^^^^^^^
KeyError: 'ttnb'
2025-12-18 22:11:48,582 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 11, 48, 580507), 'updated_at': datetime.datetime(2025, 12, 18, 22, 11, 48, 581553)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reclamations.py", line 93, in submit_reclamation
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 11, 48, 580507), 'updated_at': datetime.datetime(2025, 12, 18, 22, 11, 48, 581553)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:12:39,143 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 12, 39, 142412), 'updated_at': datetime.datetime(2025, 12, 18, 22, 12, 39, 142413)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 247, in declare_property
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 12, 39, 142412), 'updated_at': datetime.datetime(2025, 12, 18, 22, 12, 39, 142413)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:12:39,255 CRITICAL: Unexpected Error: 'ttnb' [in /app/app.py:263]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 166, in declare_land
    tax_amount=calc_result['ttnb'],
               ~~~~~~~~~~~^^^^^^^^
KeyError: 'ttnb'
2025-12-18 22:12:39,678 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 12, 39, 676947), 'updated_at': datetime.datetime(2025, 12, 18, 22, 12, 39, 677966)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reclamations.py", line 93, in submit_reclamation
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 12, 39, 676947), 'updated_at': datetime.datetime(2025, 12, 18, 22, 12, 39, 677966)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:13:09,936 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 13, 9, 935435), 'updated_at': datetime.datetime(2025, 12, 18, 22, 13, 9, 935437)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 247, in declare_property
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 13, 9, 935435), 'updated_at': datetime.datetime(2025, 12, 18, 22, 13, 9, 935437)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:13:10,118 CRITICAL: Unexpected Error: 'ttnb' [in /app/app.py:263]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 166, in declare_land
    tax_amount=calc_result['ttnb'],
               ~~~~~~~~~~~^^^^^^^^
KeyError: 'ttnb'
2025-12-18 22:13:10,837 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 13, 10, 835821), 'updated_at': datetime.datetime(2025, 12, 18, 22, 13, 10, 836921)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reclamations.py", line 93, in submit_reclamation
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 13, 10, 835821), 'updated_at': datetime.datetime(2025, 12, 18, 22, 13, 10, 836921)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:14:33,811 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 14, 33, 810652), 'updated_at': datetime.datetime(2025, 12, 18, 22, 14, 33, 810654)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 247, in declare_property
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 14, 33, 810652), 'updated_at': datetime.datetime(2025, 12, 18, 22, 14, 33, 810654)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:14:33,914 CRITICAL: Unexpected Error: 'ttnb' [in /app/app.py:263]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 166, in declare_land
    tax_amount=calc_result['ttnb'],
               ~~~~~~~~~~~^^^^^^^^
KeyError: 'ttnb'
2025-12-18 22:14:34,283 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 14, 34, 281101), 'updated_at': datetime.datetime(2025, 12, 18, 22, 14, 34, 282175)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reclamations.py", line 93, in submit_reclamation
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 14, 34, 281101), 'updated_at': datetime.datetime(2025, 12, 18, 22, 14, 34, 282175)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:16:24,560 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 16, 24, 559551), 'updated_at': datetime.datetime(2025, 12, 18, 22, 16, 24, 559552)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 247, in declare_property
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 16, 24, 559551), 'updated_at': datetime.datetime(2025, 12, 18, 22, 16, 24, 559552)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:16:24,645 CRITICAL: Unexpected Error: 'ttnb' [in /app/app.py:263]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 166, in declare_land
    tax_amount=calc_result['ttnb'],
               ~~~~~~~~~~~^^^^^^^^
KeyError: 'ttnb'
2025-12-18 22:16:24,972 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 16, 24, 971697), 'updated_at': datetime.datetime(2025, 12, 18, 22, 16, 24, 971993)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reclamations.py", line 93, in submit_reclamation
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 16, 24, 971697), 'updated_at': datetime.datetime(2025, 12, 18, 22, 16, 24, 971993)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:18:45,342 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 18, 45, 341087), 'updated_at': datetime.datetime(2025, 12, 18, 22, 18, 45, 341088)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 247, in declare_property
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 18, 45, 341087), 'updated_at': datetime.datetime(2025, 12, 18, 22, 18, 45, 341088)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:18:45,453 CRITICAL: Unexpected Error: 'ttnb' [in /app/app.py:263]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 166, in declare_land
    tax_amount=calc_result['ttnb'],
               ~~~~~~~~~~~^^^^^^^^
KeyError: 'ttnb'
2025-12-18 22:18:45,853 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 18, 45, 851664), 'updated_at': datetime.datetime(2025, 12, 18, 22, 18, 45, 852657)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reclamations.py", line 93, in submit_reclamation
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 18, 45, 851664), 'updated_at': datetime.datetime(2025, 12, 18, 22, 18, 45, 852657)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:19:07,313 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 19, 7, 312781), 'updated_at': datetime.datetime(2025, 12, 18, 22, 19, 7, 312783)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 247, in declare_property
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum propertyaffectation: "residential"
LINE 1: ...unis', NULL, NULL, 36.8065, 10.1815, 150.0, NULL, 'residenti...
                                                             ^

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'residential', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 19, 7, 312781), 'updated_at': datetime.datetime(2025, 12, 18, 22, 19, 7, 312783)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:19:07,408 CRITICAL: Unexpected Error: 'ttnb' [in /app/app.py:263]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 166, in declare_land
    tax_amount=calc_result['ttnb'],
               ~~~~~~~~~~~^^^^^^^^
KeyError: 'ttnb'
2025-12-18 22:19:07,787 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 19, 7, 785562), 'updated_at': datetime.datetime(2025, 12, 18, 22, 19, 7, 786776)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reclamations.py", line 93, in submit_reclamation
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum reclamationtype: "lighting"
LINE 1: ...resolved_date, created_at, updated_at) VALUES (2, 'lighting'...
                                                             ^

[SQL: INSERT INTO reclamations (user_id, reclamation_type, street_address, city, description, priority, status, assigned_to, resolution, resolved_date, created_at, updated_at) VALUES (%(user_id)s, %(reclamation_type)s, %(street_address)s, %(city)s, %(description)s, %(priority)s, %(status)s, %(assigned_to)s, %(resolution)s, %(resolved_date)s, %(created_at)s, %(updated_at)s) RETURNING reclamations.id]
[parameters: {'user_id': 2, 'reclamation_type': 'lighting', 'street_address': 'Main Street', 'city': 'Tunis', 'description': 'Street light not working', 'priority': 'medium', 'status': 'SUBMITTED', 'assigned_to': None, 'resolution': None, 'resolved_date': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 19, 7, 785562), 'updated_at': datetime.datetime(2025, 12, 18, 22, 19, 7, 786776)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-18 22:25:36,139 CRITICAL: Unexpected Error: 'tib' [in /app/app.py:263]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 272, in declare_property
    tax_amount=calc_result['tib'],
               ~~~~~~~~~~~^^^^^^^
KeyError: 'tib'
2025-12-18 22:26:55,915 ERROR: Database Error: (psycopg2.errors.NotNullViolation) null value in column "base_amount" of relation "taxes" violates not-null constraint
DETAIL:  Failing row contains (18, 6, null, TIB, 2025, null, null, 378, 0, null, 378, CALCULATED, null, null, 2025-12-18 22:26:55.912921, 2025-12-18 22:26:55.912922).

[SQL: INSERT INTO taxes (property_id, land_id, tax_type, tax_year, base_amount, rate_percent, tax_amount, penalty_amount, penalty_reason, total_amount, status, notification_date, notification_method, created_at, updated_at) VALUES (%(property_id)s, %(land_id)s, %(tax_type)s, %(tax_year)s, %(base_amount)s, %(rate_percent)s, %(tax_amount)s, %(penalty_amount)s, %(penalty_reason)s, %(total_amount)s, %(status)s, %(notification_date)s, %(notification_method)s, %(created_at)s, %(updated_at)s) RETURNING taxes.id]
[parameters: {'property_id': 6, 'land_id': None, 'tax_type': 'TIB', 'tax_year': 2025, 'base_amount': None, 'rate_percent': None, 'tax_amount': 378.0, 'penalty_amount': 0, 'penalty_reason': None, 'total_amount': 378.0, 'status': 'CALCULATED', 'notification_date': None, 'notification_method': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 26, 55, 912921), 'updated_at': datetime.datetime(2025, 12, 18, 22, 26, 55, 912922)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.NotNullViolation: null value in column "base_amount" of relation "taxes" violates not-null constraint
DETAIL:  Failing row contains (18, 6, null, TIB, 2025, null, null, 378, 0, null, 378, CALCULATED, null, null, 2025-12-18 22:26:55.912921, 2025-12-18 22:26:55.912922).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 278, in declare_property
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.NotNullViolation) null value in column "base_amount" of relation "taxes" violates not-null constraint
DETAIL:  Failing row contains (18, 6, null, TIB, 2025, null, null, 378, 0, null, 378, CALCULATED, null, null, 2025-12-18 22:26:55.912921, 2025-12-18 22:26:55.912922).

[SQL: INSERT INTO taxes (property_id, land_id, tax_type, tax_year, base_amount, rate_percent, tax_amount, penalty_amount, penalty_reason, total_amount, status, notification_date, notification_method, created_at, updated_at) VALUES (%(property_id)s, %(land_id)s, %(tax_type)s, %(tax_year)s, %(base_amount)s, %(rate_percent)s, %(tax_amount)s, %(penalty_amount)s, %(penalty_reason)s, %(total_amount)s, %(status)s, %(notification_date)s, %(notification_method)s, %(created_at)s, %(updated_at)s) RETURNING taxes.id]
[parameters: {'property_id': 6, 'land_id': None, 'tax_type': 'TIB', 'tax_year': 2025, 'base_amount': None, 'rate_percent': None, 'tax_amount': 378.0, 'penalty_amount': 0, 'penalty_reason': None, 'total_amount': 378.0, 'status': 'CALCULATED', 'notification_date': None, 'notification_method': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 26, 55, 912921), 'updated_at': datetime.datetime(2025, 12, 18, 22, 26, 55, 912922)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-12-18 22:26:56,013 ERROR: Database Error: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.

[SQL: INSERT INTO lands (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface, land_type, urban_zone, "vnale_value", tariff_value, is_exempt, exemption_reason, status, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface)s, %(land_type)s, %(urban_zone)s, %(vnale_value)s, %(tariff_value)s, %(is_exempt)s, %(exemption_reason)s, %(status)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING lands.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Farm Road', 'city': 'Sfax', 'delegation': None, 'post_code': None, 'latitude': 34.7406, 'longitude': 10.7603, 'surface': 5000.0, 'land_type': 'AGRICULTURAL', 'urban_zone': 'faible_densite', 'vnale_value': None, 'tariff_value': None, 'is_exempt': False, 'exemption_reason': None, 'status': 'DECLARED', 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 26, 56, 11982), 'updated_at': datetime.datetime(2025, 12, 18, 22, 26, 56, 11983)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 140, in declare_land
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.

[SQL: INSERT INTO lands (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface, land_type, urban_zone, "vnale_value", tariff_value, is_exempt, exemption_reason, status, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface)s, %(land_type)s, %(urban_zone)s, %(vnale_value)s, %(tariff_value)s, %(is_exempt)s, %(exemption_reason)s, %(status)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING lands.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Farm Road', 'city': 'Sfax', 'delegation': None, 'post_code': None, 'latitude': 34.7406, 'longitude': 10.7603, 'surface': 5000.0, 'land_type': 'AGRICULTURAL', 'urban_zone': 'faible_densite', 'vnale_value': None, 'tariff_value': None, 'is_exempt': False, 'exemption_reason': None, 'status': 'DECLARED', 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 26, 56, 11982), 'updated_at': datetime.datetime(2025, 12, 18, 22, 26, 56, 11983)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-12-18 22:28:32,024 ERROR: Database Error: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.

[SQL: INSERT INTO lands (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface, land_type, urban_zone, "vnale_value", tariff_value, is_exempt, exemption_reason, status, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface)s, %(land_type)s, %(urban_zone)s, %(vnale_value)s, %(tariff_value)s, %(is_exempt)s, %(exemption_reason)s, %(status)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING lands.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Farm Road', 'city': 'Sfax', 'delegation': None, 'post_code': None, 'latitude': 34.7406, 'longitude': 10.7603, 'surface': 5000.0, 'land_type': 'AGRICULTURAL', 'urban_zone': 'faible_densite', 'vnale_value': None, 'tariff_value': None, 'is_exempt': False, 'exemption_reason': None, 'status': 'DECLARED', 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 28, 32, 23254), 'updated_at': datetime.datetime(2025, 12, 18, 22, 28, 32, 23255)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 140, in declare_land
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.

[SQL: INSERT INTO lands (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface, land_type, urban_zone, "vnale_value", tariff_value, is_exempt, exemption_reason, status, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface)s, %(land_type)s, %(urban_zone)s, %(vnale_value)s, %(tariff_value)s, %(is_exempt)s, %(exemption_reason)s, %(status)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING lands.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Farm Road', 'city': 'Sfax', 'delegation': None, 'post_code': None, 'latitude': 34.7406, 'longitude': 10.7603, 'surface': 5000.0, 'land_type': 'AGRICULTURAL', 'urban_zone': 'faible_densite', 'vnale_value': None, 'tariff_value': None, 'is_exempt': False, 'exemption_reason': None, 'status': 'DECLARED', 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 28, 32, 23254), 'updated_at': datetime.datetime(2025, 12, 18, 22, 28, 32, 23255)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-12-18 22:29:58,727 ERROR: Database Error: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "unique_property_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Main Street 123, Tunis, 1) already exists.

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'RESIDENTIAL', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 29, 58, 725773), 'updated_at': datetime.datetime(2025, 12, 18, 22, 29, 58, 725774)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "unique_property_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Main Street 123, Tunis, 1) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/tib.py", line 247, in declare_property
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "unique_property_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Main Street 123, Tunis, 1) already exists.

[SQL: INSERT INTO properties (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface_couverte, surface_totale, affectation, nb_floors, nb_rooms, construction_year, reference_price_per_m2, tax_rate_category, service_rate, status, is_exempt, exemption_reason, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface_couverte)s, %(surface_totale)s, %(affectation)s, %(nb_floors)s, %(nb_rooms)s, %(construction_year)s, %(reference_price_per_m2)s, %(tax_rate_category)s, %(service_rate)s, %(status)s, %(is_exempt)s, %(exemption_reason)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING properties.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Main Street 123', 'city': 'Tunis', 'delegation': None, 'post_code': None, 'latitude': 36.8065, 'longitude': 10.1815, 'surface_couverte': 150.0, 'surface_totale': None, 'affectation': 'RESIDENTIAL', 'nb_floors': None, 'nb_rooms': None, 'construction_year': 2015, 'reference_price_per_m2': 900.0, 'tax_rate_category': None, 'service_rate': None, 'status': 'DECLARED', 'is_exempt': False, 'exemption_reason': None, 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 29, 58, 725773), 'updated_at': datetime.datetime(2025, 12, 18, 22, 29, 58, 725774)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-12-18 22:29:58,836 ERROR: Database Error: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.

[SQL: INSERT INTO lands (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface, land_type, urban_zone, "vnale_value", tariff_value, is_exempt, exemption_reason, status, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface)s, %(land_type)s, %(urban_zone)s, %(vnale_value)s, %(tariff_value)s, %(is_exempt)s, %(exemption_reason)s, %(status)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING lands.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Farm Road', 'city': 'Sfax', 'delegation': None, 'post_code': None, 'latitude': 34.7406, 'longitude': 10.7603, 'surface': 5000.0, 'land_type': 'AGRICULTURAL', 'urban_zone': 'faible_densite', 'vnale_value': None, 'tariff_value': None, 'is_exempt': False, 'exemption_reason': None, 'status': 'DECLARED', 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 29, 58, 833664), 'updated_at': datetime.datetime(2025, 12, 18, 22, 29, 58, 833666)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) [in /app/app.py:246]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/ttnb.py", line 140, in declare_land
    db.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 941, in flush
    return self._proxied.flush(objects=objects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "unique_land_per_owner_commune"
DETAIL:  Key (owner_id, street_address, city, commune_id)=(2, Farm Road, Sfax, 1) already exists.

[SQL: INSERT INTO lands (owner_id, commune_id, street_address, city, delegation, post_code, latitude, longitude, surface, land_type, urban_zone, "vnale_value", tariff_value, is_exempt, exemption_reason, status, satellite_verified, satellite_verification_date, satellite_notes, created_at, updated_at) VALUES (%(owner_id)s, %(commune_id)s, %(street_address)s, %(city)s, %(delegation)s, %(post_code)s, %(latitude)s, %(longitude)s, %(surface)s, %(land_type)s, %(urban_zone)s, %(vnale_value)s, %(tariff_value)s, %(is_exempt)s, %(exemption_reason)s, %(status)s, %(satellite_verified)s, %(satellite_verification_date)s, %(satellite_notes)s, %(created_at)s, %(updated_at)s) RETURNING lands.id]
[parameters: {'owner_id': 2, 'commune_id': 1, 'street_address': 'Farm Road', 'city': 'Sfax', 'delegation': None, 'post_code': None, 'latitude': 34.7406, 'longitude': 10.7603, 'surface': 5000.0, 'land_type': 'AGRICULTURAL', 'urban_zone': 'faible_densite', 'vnale_value': None, 'tariff_value': None, 'is_exempt': False, 'exemption_reason': None, 'status': 'DECLARED', 'satellite_verified': False, 'satellite_verification_date': None, 'satellite_notes': None, 'created_at': datetime.datetime(2025, 12, 18, 22, 29, 58, 833664), 'updated_at': datetime.datetime(2025, 12, 18, 22, 29, 58, 833666)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-12-24 17:52:24,007 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum paymentmethod: "bank_transfer"
LINE 1: ...date, created_at, updated_at) VALUES (2, 5, 10.0, 'bank_tran...
                                                             ^

[SQL: INSERT INTO payments (user_id, tax_id, amount, method, status, reference_number, attestation_issued, attestation_date, attestation_number, payment_date, created_at, updated_at) VALUES (%(user_id)s, %(tax_id)s, %(amount)s, %(method)s, %(status)s, %(reference_number)s, %(attestation_issued)s, %(attestation_date)s, %(attestation_number)s, %(payment_date)s, %(created_at)s, %(updated_at)s) RETURNING payments.id]
[parameters: {'user_id': 2, 'tax_id': 5, 'amount': 10.0, 'method': 'bank_transfer', 'status': 'COMPLETED', 'reference_number': 'REF-0413B1D81416F585', 'attestation_issued': False, 'attestation_date': None, 'attestation_number': None, 'payment_date': datetime.datetime(2025, 12, 24, 17, 52, 24, 4585), 'created_at': datetime.datetime(2025, 12, 24, 17, 52, 24, 4587), 'updated_at': datetime.datetime(2025, 12, 24, 17, 52, 24, 4587)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:237]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum paymentmethod: "bank_transfer"
LINE 1: ...date, created_at, updated_at) VALUES (2, 5, 10.0, 'bank_tran...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/payment.py", line 120, in make_payment
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum paymentmethod: "bank_transfer"
LINE 1: ...date, created_at, updated_at) VALUES (2, 5, 10.0, 'bank_tran...
                                                             ^

[SQL: INSERT INTO payments (user_id, tax_id, amount, method, status, reference_number, attestation_issued, attestation_date, attestation_number, payment_date, created_at, updated_at) VALUES (%(user_id)s, %(tax_id)s, %(amount)s, %(method)s, %(status)s, %(reference_number)s, %(attestation_issued)s, %(attestation_date)s, %(attestation_number)s, %(payment_date)s, %(created_at)s, %(updated_at)s) RETURNING payments.id]
[parameters: {'user_id': 2, 'tax_id': 5, 'amount': 10.0, 'method': 'bank_transfer', 'status': 'COMPLETED', 'reference_number': 'REF-0413B1D81416F585', 'attestation_issued': False, 'attestation_date': None, 'attestation_number': None, 'payment_date': datetime.datetime(2025, 12, 24, 17, 52, 24, 4585), 'created_at': datetime.datetime(2025, 12, 24, 17, 52, 24, 4587), 'updated_at': datetime.datetime(2025, 12, 24, 17, 52, 24, 4587)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-12-24 17:54:57,162 ERROR: Database Error: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum paymentmethod: "bank_transfer"
LINE 1: ...date, created_at, updated_at) VALUES (2, 5, 10.0, 'bank_tran...
                                                             ^

[SQL: INSERT INTO payments (user_id, tax_id, amount, method, status, reference_number, attestation_issued, attestation_date, attestation_number, payment_date, created_at, updated_at) VALUES (%(user_id)s, %(tax_id)s, %(amount)s, %(method)s, %(status)s, %(reference_number)s, %(attestation_issued)s, %(attestation_date)s, %(attestation_number)s, %(payment_date)s, %(created_at)s, %(updated_at)s) RETURNING payments.id]
[parameters: {'user_id': 2, 'tax_id': 5, 'amount': 10.0, 'method': 'bank_transfer', 'status': 'COMPLETED', 'reference_number': 'REF-40D7713F4424F12A', 'attestation_issued': False, 'attestation_date': None, 'attestation_number': None, 'payment_date': datetime.datetime(2025, 12, 24, 17, 54, 57, 161896), 'created_at': datetime.datetime(2025, 12, 24, 17, 54, 57, 161898), 'updated_at': datetime.datetime(2025, 12, 24, 17, 54, 57, 161898)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h) [in /app/app.py:237]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidTextRepresentation: invalid input value for enum paymentmethod: "bank_transfer"
LINE 1: ...date, created_at, updated_at) VALUES (2, 5, 10.0, 'bank_tran...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/app/resources/payment.py", line 120, in make_payment
    db.session.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py", line 598, in commit
    return self._proxied.commit()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4312, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4447, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4408, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.DataError: (psycopg2.errors.InvalidTextRepresentation) invalid input value for enum paymentmethod: "bank_transfer"
LINE 1: ...date, created_at, updated_at) VALUES (2, 5, 10.0, 'bank_tran...
                                                             ^

[SQL: INSERT INTO payments (user_id, tax_id, amount, method, status, reference_number, attestation_issued, attestation_date, attestation_number, payment_date, created_at, updated_at) VALUES (%(user_id)s, %(tax_id)s, %(amount)s, %(method)s, %(status)s, %(reference_number)s, %(attestation_issued)s, %(attestation_date)s, %(attestation_number)s, %(payment_date)s, %(created_at)s, %(updated_at)s) RETURNING payments.id]
[parameters: {'user_id': 2, 'tax_id': 5, 'amount': 10.0, 'method': 'bank_transfer', 'status': 'COMPLETED', 'reference_number': 'REF-40D7713F4424F12A', 'attestation_issued': False, 'attestation_date': None, 'attestation_number': None, 'payment_date': datetime.datetime(2025, 12, 24, 17, 54, 57, 161896), 'created_at': datetime.datetime(2025, 12, 24, 17, 54, 57, 161898), 'updated_at': datetime.datetime(2025, 12, 24, 17, 54, 57, 161898)}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2026-01-09 02:27:22,829 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 02:32:22,056 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 02:32:28,718 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 02:32:28,736 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 02:48:14,742 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 02:48:14,756 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 02:48:27,071 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 03:08:55,216 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 03:10:07,952 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 03:11:06,371 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 03:12:08,077 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 03:13:35,678 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 03:16:27,879 CRITICAL: Unexpected Error: name 'request' is not defined [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/resources/budget_voting.py", line 113, in get_budget_projects
    status = request.args.get('status')
             ^^^^^^^
NameError: name 'request' is not defined
2026-01-09 03:59:23,088 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.reference_price,
    ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 04:05:05,993 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.affectation,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 04:09:05,432 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.affectation,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 04:14:53,884 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.affectation,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 04:19:18,752 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.affectation,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 04:23:52,863 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.affectation,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 04:28:35,390 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.affectation,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 04:39:46,120 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 04:39:46,378 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.affectation,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:06:28,919 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 17:06:29,063 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.affectation,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:17:27,345 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:17:27,363 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 17:19:06,133 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:19:06,145 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 17:20:42,634 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:20:42,650 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 17:22:36,589 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:22:36,600 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 17:35:04,329 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:35:04,342 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 17:38:19,483 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:38:19,525 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 17:54:16,133 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 17:54:16,193 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 17:54:30,040 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 18:01:02,124 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 18:01:02,141 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 18:01:13,334 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:320]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 66, in export_properties_report
    prop.city,
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 18:20:36,665 CRITICAL: Unexpected Error: 'Property' object has no attribute 'reference_price' [in /app/app.py:326]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/reports.py", line 69, in export_properties_report
    prop.reference_price,
    ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Property' object has no attribute 'reference_price'
2026-01-09 18:20:36,703 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:326]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 154, in renew_land_alias
    return renew_land_tax(args, land_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
2026-01-09 18:22:37,367 CRITICAL: Unexpected Error: renew_land_alias() got multiple values for argument 'land_id' [in /app/app.py:326]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_alias() got multiple values for argument 'land_id'
2026-01-09 18:23:51,748 CRITICAL: Unexpected Error: renew_land_tax() takes 2 positional arguments but 3 were given [in /app/app.py:326]
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 870, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask/app.py", line 855, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/app/resources/renewal.py", line 152, in renew_land_alias
    return renew_land_tax(land_id, {})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/webargs/core.py", line 652, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/arguments.py", line 85, in wrapper
    return current_app.ensure_sync(func)(*f_args, **f_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/flask_smorest/response.py", line 89, in wrapper
    current_app.ensure_sync(func)(*args, **kwargs)
  File "/usr/local/lib/python3.11/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/utils/role_required.py", line 28, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
TypeError: renew_land_tax() takes 2 positional arguments but 3 were given
